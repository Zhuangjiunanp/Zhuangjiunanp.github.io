<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; script-src 'self'; img-src 'self'; connect-src https://api.github.com; worker-src 'none'">
  <title>English Resources</title>
</head>

<body>
  <h1>English Resources</h1>
  
  <div id="listing">
    <pre>Loading file list...</pre>
  </div>

  <script>
    // GitHub仓库信息
    const repoOwner = 'zhuangjiunanp';
    const repoName = 'zhuangjiunanp.github.io';
    const folderPath = 'english';
    
    // 获取文件列表
    function loadFileList() {
      var apiUrl = 'https://api.github.com/repos/' + repoOwner + '/' + repoName + '/contents/' + folderPath;
      var xhr = new XMLHttpRequest();
      
      xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
          var listingEl = document.getElementById('listing');
          
          if (xhr.status === 200) {
            var files = JSON.parse(xhr.responseText);
            renderFileList(files);
          } else {
            listingEl.innerHTML = '<pre>Error loading file list</pre>';
          }
        }
      };
      
      xhr.open('GET', apiUrl, true);
      xhr.send();
    }
    
    // 渲染文件列表（pre格式）
    function renderFileList(files) {
      var listingEl = document.getElementById('listing');
      var html = '<pre>';
      
      // 表头
      html += 'Name'.padEnd(50) + 'Last Modified'.padEnd(20) + 'Size\n';
      html += '-'.repeat(80) + '\n';
      
      // 上级目录
      html += '<a href="../">../</a>\n';
      
      // 文件列表
      files.forEach(function(item) {
        if (item.name !== 'index.html') {
          var date = new Date(item.updated_at || item.created_at);
          var dateStr = date.toLocaleDateString();
          var name = item.type === 'dir' ? item.name + '/' : item.name;
          var size = item.size ? formatSize(item.size) : '-';
          
          // 创建链接
          var link = '<a href="' + (item.type === 'dir' ? name : item.name) + '">' + name + '</a>';
          
          // 格式化行
          var line = link.padEnd(50) + dateStr.padEnd(20) + size;
          html += line + '\n';
        }
      });
      
      html += '</pre>';
      listingEl.innerHTML = html;
    }
    
    // 格式化文件大小
    function formatSize(bytes) {
      if (!bytes || bytes === 0) return '-';
      var sizes = ['B', 'KB', 'MB', 'GB'];
      var i = Math.floor(Math.log(bytes) / Math.log(1024));
      return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
    }
    
    // 页面加载时执行
    if (window.addEventListener) {
      window.addEventListener('load', loadFileList);
    } else {
      window.attachEvent('onload', loadFileList);
    }
  </script>
</body>

</html>
